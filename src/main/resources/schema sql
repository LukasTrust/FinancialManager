-- Create USER table
create table if not exists users
(
    id         bigint generated by default as identity
        primary key,
    email      varchar(255) not null
        unique,
    first_name varchar(255) not null,
    last_name  varchar(255) not null,
    password   varchar(255) not null
);



-- Create BANKACCOUNT table
create table if not exists  bank_account
(
    id                                  bigint generated by default as identity
        primary key,
    user_id                             bigint not null
        constraint bank_account_to_users
            references users,
    description                  varchar(255),
        name                         varchar(255) not null,
    currency_symbol                     varchar(5),
    amount_in_bank_after_search_strings jsonb,
    amount_search_strings               jsonb,
    counter_party_search_strings        jsonb,
    date_search_strings                 jsonb
);

-- Create SAVINGS-BANK-ACCOUNT table
create table if not exists savings_bank_account
(
    interest_rate                double precision not null,
    id                           bigint           not null
        primary key
        constraint saving_bank_account
            references bank_account,
    interest_rate_search_strings jsonb
);

-- Create COUNTER-PARTY table
create table if not exists counter_party
(
    id                           bigint generated by default as identity
        primary key,
    user_id                             bigint not null
            constraint counter_party_to_users
                references users,
    counter_party_search_strings JSONB,
    description                  varchar(255),
    name                         varchar(255) not null,
    is_Hidden             boolean not null DEFAULT FALSE
);

-- Create CONTRACT table
create table if not exists contract
(
    months_between_payments integer      not null,
    end_date                date,
    id                      bigint generated by default as identity
        primary key,
    last_updated_at         date not null,
    start_date              date not null,
    last_payment_date       date not null,
    counter_party_id        bigint not null
                                           constraint contract_counter_party
                                               references counter_party,
    bank_account_Id                 bigint not null
                                           constraint contract_bank_account_Id
                                               references bank_account,
    description             varchar(255),
    name                    varchar(255) not null,
    amount double precision not null,
    is_Hidden             boolean not null DEFAULT FALSE
);



-- Create CONTRACT-HISTORY table
create table if not exists contract_history
(
    new_amount      double precision not null,
    previous_amount double precision not null,
    changed_at      date     not null,
    contract_id     bigint           not null
        unique
        constraint contract_history_contract
            references contract,
    id              bigint generated by default as identity
        primary key
);

-- Create CATEGORY table
create table if not exists category
(
    max_spending_per_month       double precision,
    id                           bigint generated by default as identity
        primary key,
    user_id                             bigint not null
            constraint category_to_users
                references users,
    counter_party_search_strings jsonb,
    description                  varchar(255),
    name                         varchar(255) not null
);



-- Create TRANSACTION table
create table if not exists transaction
(
    amount                double precision not null,
    amount_in_bank_after  double precision not null,
    amount_in_bank_before double precision not null,
    original_counter_party varchar(255) not null,
    bank_account_id            bigint           not null
        constraint transaction_to_bank_account
            references bank_account,
    category_id           bigint
        constraint transaction_to_category
            references category,
    contract_id           bigint
        constraint transaction_to_contract
            references contract,
    counter_party_id      bigint
        constraint transaction_to_counter_party
            references counter_party,
    date                  date     not null,
    is_Hidden             boolean not null DEFAULT FALSE,
    id                    bigint generated by default as identity
        primary key
);

