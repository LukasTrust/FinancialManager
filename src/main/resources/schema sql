-- Create USER table
create table if not exists users
(
    id         bigint generated by default as identity
        primary key,
    email      varchar(255) not null
        unique,
    first_name varchar(255) not null,
    last_name  varchar(255) not null,
    password   varchar(255) not null
);



-- Create BANKACCOUNT table
create table if not exists  bank_account
(
    id                                  bigint generated by default as identity
        primary key,
    user_id                             bigint not null
        constraint bank_account_to_users
            references users,
    description                  varchar(255),
        name                         varchar(255) not null,
    amount_in_bank_after_search_strings varchar(255),
    amount_search_strings               varchar(255),
    counter_party_search_strings        varchar(255),
    date_search_strings                 varchar(255)
);

-- Create SAVINGS-BANK-ACCOUNT table
create table if not exists savings_bank_account
(
    interest_rate                double precision not null,
    id                           bigint           not null
        primary key
        constraint saving_bank_account
            references bank_account,
    interest_rate_search_strings varchar(255)
);



-- Create CONTRACT table
create table if not exists contract
(
    months_between_payments integer      not null,
    end_date                timestamp(6),
    id                      bigint generated by default as identity
        primary key,
    last_updated_at         timestamp(6) not null,
    start_date              timestamp(6) not null,
    last_payment_date       timestamp(6) not null,
    contract_search_strings varchar(255),
    description             varchar(255),
    name                    varchar(255) not null,
    amount double precision not null
);



-- Create CONTRACT-HISTORY table
create table if not exists contract_history
(
    new_amount      double precision not null,
    previous_amount double precision not null,
    changed_at      timestamp(6)     not null,
    contract_id     bigint           not null
        unique
        constraint contract_history_contract
            references contract,
    id              bigint generated by default as identity
        primary key
);



-- Create COUNTER-PARTY table
create table if not exists counter_party
(
    id                           bigint generated by default as identity
        primary key,
    counter_party_search_strings varchar(255),
    description                  varchar(255),
    name                         varchar(255) not null
);



-- Create CATEGORY table
create table if not exists category
(
    max_spending_per_month       double precision,
    id                           bigint generated by default as identity
        primary key,
    counter_party_search_strings varchar(255),
    description                  varchar(255),
    name                         varchar(255) not null
);



-- Create TRANSACTION table
create table if not exists transaction
(
    amount                double precision not null,
    amount_in_bank_after  double precision not null,
    amount_in_bank_before double precision not null,
    original_counter_party varchar(255) not null,
    bank_account_id            bigint           not null
        constraint transaction_to_bank_account
            references bank_account,
    category_id           bigint
        constraint transaction_to_category
            references category,
    contract_id           bigint
        constraint transaction_to_contract
            references contract,
    counter_party_id      bigint
        constraint transaction_to_counter_party
            references counter_party,
    date                  timestamp(6)     not null,
    id                    bigint generated by default as identity
        primary key
);

